(window.webpackJsonp=window.webpackJsonp||[]).push([[334],{1129:function(e,a,t){"use strict";t.r(a);var n=t(0),s=t.n(n),c=t(1169);a.default=function(e){const[a,t]=Object(n.useState)(!1),[l,m]=Object(n.useState)(!1);localStorage.getItem("arco-lang");return s.a.createElement("span",{style:e.style,className:"markdown-body"},s.a.createElement(c.a,null,s.a.createElement("title",null,"路由与菜单 | SensoroDesign"),s.a.createElement("meta",{name:"description",content:"路由和菜单的生成。"}),s.a.createElement("meta",{property:"og:title",content:"路由与菜单 | SensoroDesign"}),s.a.createElement("meta",{property:"og:description",content:"路由和菜单的生成。"})),s.a.createElement("div",{className:"ac-nav-intro"},s.a.createElement("p",null,"Arco Pro"),s.a.createElement("h1",{id:"路由与菜单"},"路由与菜单"),s.a.createElement("p",null,"路由和菜单的生成。")),s.a.createElement("p",null,"路由通常都和菜单绑定在一起，为了减少维护的量，我们直接通过路由表生成了菜单。"),s.a.createElement("h2",{id:"路由"},"路由"),s.a.createElement("p",null,"首先，需要先了解一下路由表的配置"),s.a.createElement("pre",{className:"code_block"},s.a.createElement("code",{className:"language-js"},s.a.createElement("span",{className:"token comment"},"// src/routes.ts"),s.a.createElement("br",null),s.a.createElement("span",{className:"token keyword module"},"export")," ",s.a.createElement("span",{className:"token keyword"},"const")," routes ",s.a.createElement("span",{className:"token operator"},"=")," ",s.a.createElement("span",{className:"token punctuation"},"["),s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"token punctuation"},"{"),s.a.createElement("br",null),"    name",s.a.createElement("span",{className:"token operator"},":")," ",s.a.createElement("span",{className:"token string"},"'menu.dashboard'"),s.a.createElement("span",{className:"token punctuation"},","),"                 ",s.a.createElement("span",{className:"token comment"},"// 菜单名，locale['menu.dashboard']"),s.a.createElement("br",null),"    key",s.a.createElement("span",{className:"token operator"},":")," ",s.a.createElement("span",{className:"token string"},"'dashboard'"),s.a.createElement("span",{className:"token punctuation"},","),"                       ",s.a.createElement("span",{className:"token comment"},"// 菜单项 key，也是菜单 path"),s.a.createElement("br",null),"    children",s.a.createElement("span",{className:"token operator"},":")," ",s.a.createElement("span",{className:"token punctuation"},"["),s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"token punctuation"},"{"),s.a.createElement("br",null),"        name",s.a.createElement("span",{className:"token operator"},":")," ",s.a.createElement("span",{className:"token string"},"'menu.dashboard.workplace'"),s.a.createElement("span",{className:"token punctuation"},","),"   ",s.a.createElement("span",{className:"token comment"},"// 菜单名，locale['menu.dashboard.workplace']"),s.a.createElement("br",null),"        key",s.a.createElement("span",{className:"token operator"},":")," ",s.a.createElement("span",{className:"token string"},"'dashboard/workplace'"),s.a.createElement("span",{className:"token punctuation"},","),"         ",s.a.createElement("span",{className:"token comment"},"// 菜单项 key，也是菜单 path"),s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"token punctuation"},"}"),s.a.createElement("span",{className:"token punctuation"},","),s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"token punctuation"},"]"),s.a.createElement("span",{className:"token punctuation"},","),s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"token punctuation"},"}"),s.a.createElement("span",{className:"token punctuation"},","),s.a.createElement("br",null),s.a.createElement("span",{className:"token punctuation"},"]"),s.a.createElement("span",{className:"token punctuation"},";"))),s.a.createElement("p",null,"解释一下其中的几个变量："),s.a.createElement("ul",null,s.a.createElement("li",null,s.a.createElement("code",null,"name")," 菜单项的名字，写的是语言包中的 key 值"),s.a.createElement("li",null,s.a.createElement("code",null,"key")," 菜单项的 key，同时也作为 path 使用, 这里会将 ",s.a.createElement("code",null,"pages/$","{","route.key","}")," 作为组件路径"),s.a.createElement("li",null,s.a.createElement("code",null,"children")," 子菜单数组，各个字段同父菜单一致"),s.a.createElement("li",null,s.a.createElement("code",null,"breadcrumb")," 是否展示在当前页面展示面包屑")),s.a.createElement("p",null,"路由配置很直观，所配置的这几个变量都是为了生成菜单以及处理路由跳转使用的，接下来看一下菜单和路由是如何串联起来的。"),s.a.createElement("h2",{id:"菜单"},"菜单"),s.a.createElement("p",null,"菜单栏是布局的一部分，所以从布局组件中就可以找到菜单生成过程："),s.a.createElement("ol",null,s.a.createElement("li",null,"通过 ",s.a.createElement("code",null,"getFlattenRoutes")," 得到带有路由组件的路由的扁平数组 ",s.a.createElement("code",null,"flattenRoutes"),"，用于生成路由")),s.a.createElement("pre",{className:"code_block"},s.a.createElement("code",{className:"language-js"},s.a.createElement("span",{className:"token keyword"},"function")," ",s.a.createElement("span",{className:"token function"},"getFlattenRoutes"),s.a.createElement("span",{className:"token punctuation"},"("),s.a.createElement("span",{className:"token punctuation"},")")," ",s.a.createElement("span",{className:"token punctuation"},"{"),s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"token keyword"},"const")," res ",s.a.createElement("span",{className:"token operator"},"=")," ",s.a.createElement("span",{className:"token punctuation"},"["),s.a.createElement("span",{className:"token punctuation"},"]"),s.a.createElement("span",{className:"token punctuation"},";"),s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"token keyword"},"function")," ",s.a.createElement("span",{className:"token function"},"travel"),s.a.createElement("span",{className:"token punctuation"},"("),s.a.createElement("span",{className:"token parameter"},"_routes"),s.a.createElement("span",{className:"token punctuation"},")")," ",s.a.createElement("span",{className:"token punctuation"},"{"),s.a.createElement("br",null),"    _routes",s.a.createElement("span",{className:"token punctuation"},"."),s.a.createElement("span",{className:"token method function property-access"},"forEach"),s.a.createElement("span",{className:"token punctuation"},"("),s.a.createElement("span",{className:"token punctuation"},"("),s.a.createElement("span",{className:"token parameter"},"route"),s.a.createElement("span",{className:"token punctuation"},")")," ",s.a.createElement("span",{className:"token arrow operator"},"=>")," ",s.a.createElement("span",{className:"token punctuation"},"{"),s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"token keyword control-flow"},"if")," ",s.a.createElement("span",{className:"token punctuation"},"("),"route",s.a.createElement("span",{className:"token punctuation"},"."),s.a.createElement("span",{className:"token property-access"},"key")," ",s.a.createElement("span",{className:"token operator"},"&&")," ",s.a.createElement("span",{className:"token operator"},"!"),"route",s.a.createElement("span",{className:"token punctuation"},"."),s.a.createElement("span",{className:"token property-access"},"children"),s.a.createElement("span",{className:"token punctuation"},")")," ",s.a.createElement("span",{className:"token punctuation"},"{"),s.a.createElement("br",null),"        route",s.a.createElement("span",{className:"token punctuation"},"."),s.a.createElement("span",{className:"token property-access"},"component")," ",s.a.createElement("span",{className:"token operator"},"=")," ",s.a.createElement("span",{className:"token function"},"lazyload"),s.a.createElement("span",{className:"token punctuation"},"("),s.a.createElement("span",{className:"token punctuation"},"("),s.a.createElement("span",{className:"token punctuation"},")")," ",s.a.createElement("span",{className:"token arrow operator"},"=>")," ",s.a.createElement("span",{className:"token keyword module"},"import"),s.a.createElement("span",{className:"token punctuation"},"("),s.a.createElement("span",{className:"token template-string"},s.a.createElement("span",{className:"token template-punctuation string"},"`"),s.a.createElement("span",{className:"token string"},"./pages/"),s.a.createElement("span",{className:"token interpolation"},s.a.createElement("span",{className:"token interpolation-punctuation punctuation"},"$","{"),"route",s.a.createElement("span",{className:"token punctuation"},"."),s.a.createElement("span",{className:"token property-access"},"key"),s.a.createElement("span",{className:"token interpolation-punctuation punctuation"},"}")),s.a.createElement("span",{className:"token template-punctuation string"},"`")),s.a.createElement("span",{className:"token punctuation"},")"),s.a.createElement("span",{className:"token punctuation"},")"),s.a.createElement("span",{className:"token punctuation"},";"),s.a.createElement("br",null),"        res",s.a.createElement("span",{className:"token punctuation"},"."),s.a.createElement("span",{className:"token method function property-access"},"push"),s.a.createElement("span",{className:"token punctuation"},"("),"route",s.a.createElement("span",{className:"token punctuation"},")"),s.a.createElement("span",{className:"token punctuation"},";"),s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"token punctuation"},"}")," ",s.a.createElement("span",{className:"token keyword control-flow"},"else")," ",s.a.createElement("span",{className:"token keyword control-flow"},"if")," ",s.a.createElement("span",{className:"token punctuation"},"("),s.a.createElement("span",{className:"token function"},"isArray"),s.a.createElement("span",{className:"token punctuation"},"("),"route",s.a.createElement("span",{className:"token punctuation"},"."),s.a.createElement("span",{className:"token property-access"},"children"),s.a.createElement("span",{className:"token punctuation"},")")," ",s.a.createElement("span",{className:"token operator"},"&&")," route",s.a.createElement("span",{className:"token punctuation"},"."),s.a.createElement("span",{className:"token property-access"},"children"),s.a.createElement("span",{className:"token punctuation"},"."),s.a.createElement("span",{className:"token property-access"},"length"),s.a.createElement("span",{className:"token punctuation"},")")," ",s.a.createElement("span",{className:"token punctuation"},"{"),s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"token function"},"travel"),s.a.createElement("span",{className:"token punctuation"},"("),"route",s.a.createElement("span",{className:"token punctuation"},"."),s.a.createElement("span",{className:"token property-access"},"children"),s.a.createElement("span",{className:"token punctuation"},")"),s.a.createElement("span",{className:"token punctuation"},";"),s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"token punctuation"},"}"),s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"token punctuation"},"}"),s.a.createElement("span",{className:"token punctuation"},")"),s.a.createElement("span",{className:"token punctuation"},";"),s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"token punctuation"},"}"),s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"token function"},"travel"),s.a.createElement("span",{className:"token punctuation"},"("),"routes",s.a.createElement("span",{className:"token punctuation"},")"),s.a.createElement("span",{className:"token punctuation"},";"),s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"token keyword control-flow"},"return")," res",s.a.createElement("span",{className:"token punctuation"},";"),s.a.createElement("br",null),s.a.createElement("span",{className:"token punctuation"},"}"),s.a.createElement("br",null))),s.a.createElement("ol",{start:"2"},s.a.createElement("li",null,"通过 ",s.a.createElement("code",null,"flattenRoutes")," 遍历路由表生成菜单项")),s.a.createElement("pre",{className:"code_block"},s.a.createElement("code",{className:"language-js"},s.a.createElement("span",{className:"token tag"},s.a.createElement("span",{className:"token tag"},s.a.createElement("span",{className:"token punctuation"},"<"),s.a.createElement("span",{className:"token class-name"},"Switch")),s.a.createElement("span",{className:"token punctuation"},">")),s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"token punctuation"},"{"),"flattenRoutes",s.a.createElement("span",{className:"token punctuation"},"."),s.a.createElement("span",{className:"token method function property-access"},"map"),s.a.createElement("span",{className:"token punctuation"},"("),s.a.createElement("span",{className:"token punctuation"},"("),s.a.createElement("span",{className:"token parameter"},"route"),s.a.createElement("span",{className:"token punctuation"},")")," ",s.a.createElement("span",{className:"token arrow operator"},"=>")," ",s.a.createElement("span",{className:"token punctuation"},"{"),s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"token keyword control-flow"},"return")," ",s.a.createElement("span",{className:"token tag"},s.a.createElement("span",{className:"token tag"},s.a.createElement("span",{className:"token punctuation"},"<"),s.a.createElement("span",{className:"token class-name"},"Route"))," ",s.a.createElement("span",{className:"token attr-name"},"key"),s.a.createElement("span",{className:"token script language-javascript"},s.a.createElement("span",{className:"token script-punctuation punctuation"},"="),s.a.createElement("span",{className:"token punctuation"},"{"),"route",s.a.createElement("span",{className:"token punctuation"},"."),s.a.createElement("span",{className:"token property-access"},"key"),s.a.createElement("span",{className:"token punctuation"},"}"))," ",s.a.createElement("span",{className:"token attr-name"},"path"),s.a.createElement("span",{className:"token script language-javascript"},s.a.createElement("span",{className:"token script-punctuation punctuation"},"="),s.a.createElement("span",{className:"token punctuation"},"{"),s.a.createElement("span",{className:"token template-string"},s.a.createElement("span",{className:"token template-punctuation string"},"`"),s.a.createElement("span",{className:"token string"},"/"),s.a.createElement("span",{className:"token interpolation"},s.a.createElement("span",{className:"token interpolation-punctuation punctuation"},"$","{"),"route",s.a.createElement("span",{className:"token punctuation"},"."),s.a.createElement("span",{className:"token property-access"},"key"),s.a.createElement("span",{className:"token interpolation-punctuation punctuation"},"}")),s.a.createElement("span",{className:"token template-punctuation string"},"`")),s.a.createElement("span",{className:"token punctuation"},"}"))," ",s.a.createElement("span",{className:"token attr-name"},"component"),s.a.createElement("span",{className:"token script language-javascript"},s.a.createElement("span",{className:"token script-punctuation punctuation"},"="),s.a.createElement("span",{className:"token punctuation"},"{"),"route",s.a.createElement("span",{className:"token punctuation"},"."),s.a.createElement("span",{className:"token property-access"},"component"),s.a.createElement("span",{className:"token punctuation"},"}"))," ",s.a.createElement("span",{className:"token punctuation"},"/>")),s.a.createElement("span",{className:"token punctuation"},";"),s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"token punctuation"},"}"),s.a.createElement("span",{className:"token punctuation"},")"),s.a.createElement("span",{className:"token punctuation"},"}"),s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"token tag"},s.a.createElement("span",{className:"token tag"},s.a.createElement("span",{className:"token punctuation"},"<"),s.a.createElement("span",{className:"token class-name"},"Redirect"))," ",s.a.createElement("span",{className:"token attr-name"},"push")," ",s.a.createElement("span",{className:"token attr-name"},"to"),s.a.createElement("span",{className:"token script language-javascript"},s.a.createElement("span",{className:"token script-punctuation punctuation"},"="),s.a.createElement("span",{className:"token punctuation"},"{"),s.a.createElement("span",{className:"token template-string"},s.a.createElement("span",{className:"token template-punctuation string"},"`"),s.a.createElement("span",{className:"token string"},"/"),s.a.createElement("span",{className:"token interpolation"},s.a.createElement("span",{className:"token interpolation-punctuation punctuation"},"$","{"),"defaultRoute",s.a.createElement("span",{className:"token interpolation-punctuation punctuation"},"}")),s.a.createElement("span",{className:"token template-punctuation string"},"`")),s.a.createElement("span",{className:"token punctuation"},"}"))," ",s.a.createElement("span",{className:"token punctuation"},"/>")),s.a.createElement("br",null),s.a.createElement("span",{className:"token tag"},s.a.createElement("span",{className:"token tag"},s.a.createElement("span",{className:"token punctuation"},"</"),s.a.createElement("span",{className:"token class-name"},"Switch")),s.a.createElement("span",{className:"token punctuation"},">")))),s.a.createElement("h2",{id:"新增一个菜单项的步骤"},"新增一个菜单项的步骤"),s.a.createElement("p",null,"了解完路由和菜单的生成，就可以上手配置一个新的菜单项了，以新增一个监控页面为例。"),s.a.createElement("ol",{start:"3"},s.a.createElement("li",null,"在 pages 中新增一个 monitor 文件夹，并在其中新增 index.tsx")),s.a.createElement("pre",{className:"code_block"},s.a.createElement("code",{className:"language-js"},s.a.createElement("span",{className:"token comment"},"// src/pages/monitor/index.tsx"),s.a.createElement("br",null),s.a.createElement("span",{className:"token keyword module"},"import")," ",s.a.createElement("span",{className:"token imports"},s.a.createElement("span",{className:"token maybe-class-name"},"React"))," ",s.a.createElement("span",{className:"token keyword module"},"from")," ",s.a.createElement("span",{className:"token string"},"'react'"),s.a.createElement("span",{className:"token punctuation"},";"),s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("span",{className:"token keyword module"},"export")," ",s.a.createElement("span",{className:"token keyword module"},"default")," ",s.a.createElement("span",{className:"token keyword"},"function")," ",s.a.createElement("span",{className:"token function"},s.a.createElement("span",{className:"token maybe-class-name"},"Monitor")),s.a.createElement("span",{className:"token punctuation"},"("),s.a.createElement("span",{className:"token punctuation"},")")," ",s.a.createElement("span",{className:"token punctuation"},"{"),s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"token keyword control-flow"},"return")," ",s.a.createElement("span",{className:"token tag"},s.a.createElement("span",{className:"token tag"},s.a.createElement("span",{className:"token punctuation"},"<"),"div"),s.a.createElement("span",{className:"token punctuation"},">")),"监控页",s.a.createElement("span",{className:"token tag"},s.a.createElement("span",{className:"token tag"},s.a.createElement("span",{className:"token punctuation"},"</"),"div"),s.a.createElement("span",{className:"token punctuation"},">")),s.a.createElement("span",{className:"token punctuation"},";"),s.a.createElement("br",null),s.a.createElement("span",{className:"token punctuation"},"}"))),s.a.createElement("ol",{start:"4"},s.a.createElement("li",null,"在路由表中新增监控页的路由配置")),s.a.createElement("pre",{className:"code_block"},s.a.createElement("code",{className:"language-js"},s.a.createElement("span",{className:"token comment"},"// src/routes.ts"),s.a.createElement("br",null),s.a.createElement("span",{className:"token keyword module"},"export")," ",s.a.createElement("span",{className:"token keyword"},"const")," routes ",s.a.createElement("span",{className:"token operator"},"=")," ",s.a.createElement("span",{className:"token punctuation"},"["),s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"token punctuation"},"{"),s.a.createElement("br",null),"    name",s.a.createElement("span",{className:"token operator"},":")," ",s.a.createElement("span",{className:"token string"},"'menu.dashboard'"),s.a.createElement("span",{className:"token punctuation"},","),s.a.createElement("br",null),"    key",s.a.createElement("span",{className:"token operator"},":")," ",s.a.createElement("span",{className:"token string"},"'dashboard'"),s.a.createElement("span",{className:"token punctuation"},","),s.a.createElement("br",null),"    children",s.a.createElement("span",{className:"token operator"},":")," ",s.a.createElement("span",{className:"token punctuation"},"["),s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"token punctuation"},"{"),s.a.createElement("br",null),"        name",s.a.createElement("span",{className:"token operator"},":")," ",s.a.createElement("span",{className:"token string"},"'menu.dashboard.workplace'"),s.a.createElement("span",{className:"token punctuation"},","),s.a.createElement("br",null),"        key",s.a.createElement("span",{className:"token operator"},":")," ",s.a.createElement("span",{className:"token string"},"'dashboard/workplace'"),s.a.createElement("span",{className:"token punctuation"},","),s.a.createElement("br",null),"        componentPath",s.a.createElement("span",{className:"token operator"},":")," ",s.a.createElement("span",{className:"token string"},"'workPlace'"),s.a.createElement("span",{className:"token punctuation"},","),s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"token punctuation"},"}"),s.a.createElement("span",{className:"token punctuation"},","),s.a.createElement("br",null),s.a.createElement("span",{className:"token operator"},"+"),"     ",s.a.createElement("span",{className:"token punctuation"},"{"),s.a.createElement("br",null),s.a.createElement("span",{className:"token operator"},"+"),"       name",s.a.createElement("span",{className:"token operator"},":")," ",s.a.createElement("span",{className:"token string"},"'menu.dashboard.monitor'"),s.a.createElement("span",{className:"token punctuation"},","),s.a.createElement("br",null),s.a.createElement("span",{className:"token operator"},"+"),"       key",s.a.createElement("span",{className:"token operator"},":")," ",s.a.createElement("span",{className:"token string"},"'dashboard/monitor'"),s.a.createElement("span",{className:"token punctuation"},","),s.a.createElement("br",null),s.a.createElement("span",{className:"token operator"},"+"),"     ",s.a.createElement("span",{className:"token punctuation"},"}"),s.a.createElement("span",{className:"token punctuation"},","),s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"token punctuation"},"]"),s.a.createElement("span",{className:"token punctuation"},","),s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"token punctuation"},"}"),s.a.createElement("span",{className:"token punctuation"},","),s.a.createElement("br",null),s.a.createElement("span",{className:"token punctuation"},"]"),s.a.createElement("span",{className:"token punctuation"},";"))),s.a.createElement("ol",{start:"5"},s.a.createElement("li",null,"在语言包中新增菜单名")),s.a.createElement("p",null,"以下是中文语言包，其他语言包不赘述。"),s.a.createElement("pre",{className:"code_block"},s.a.createElement("code",{className:"language-js"},s.a.createElement("span",{className:"token comment"},"// src/local/zh-CN.ts"),s.a.createElement("br",null),s.a.createElement("span",{className:"token keyword module"},"export")," ",s.a.createElement("span",{className:"token keyword module"},"default")," ",s.a.createElement("span",{className:"token punctuation"},"{"),s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"token string"},"'menu.dashboard'"),s.a.createElement("span",{className:"token operator"},":")," ",s.a.createElement("span",{className:"token string"},"'仪表盘'"),s.a.createElement("span",{className:"token punctuation"},","),s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"token string"},"'menu.dashboard.workplace'"),s.a.createElement("span",{className:"token operator"},":")," ",s.a.createElement("span",{className:"token string"},"'工作台'"),s.a.createElement("span",{className:"token punctuation"},","),s.a.createElement("br",null),s.a.createElement("span",{className:"token operator"},"+")," ",s.a.createElement("span",{className:"token string"},"'menu.dashboard.monitor'"),s.a.createElement("span",{className:"token operator"},":")," ",s.a.createElement("span",{className:"token string"},"'实时监控'"),s.a.createElement("span",{className:"token punctuation"},","),s.a.createElement("br",null),s.a.createElement("span",{className:"token punctuation"},"}"))),s.a.createElement("p",null,"以上，就完成了一个菜单项的配置。现在刷新一下页面，就能看到新的菜单项。"))}}}]);